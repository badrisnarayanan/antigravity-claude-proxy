services:
  antigravity-claude-proxy:
    container_name: antigravity-claude-proxy
    build:
      context: ..
      dockerfile: docker/Dockerfile

    # 生产环境建议使用固定端口或通过反向代理暴露
    ports:
      - "8080:8080"

    environment:
      # Node 运行环境
      NODE_ENV: production
      # 应用监听端口（与 EXPOSE 及 config.example.json 中默认端口保持一致）
      PORT: 8080

      # 可选：为 /v1/* 接口设置简单 API 访问密钥
      # API_KEY: "change-me-api-key"

      # 可选：为 Web 管理界面设置访问密码
      # WEBUI_PASSWORD: "change-me-webui-password"

    # 持久化账户信息、OAuth 令牌、配置信息等
    # 在项目根目录创建 data/ 目录：
    # - data/ 保存 accounts.json、SQLite DB 等运行期数据
    # 注意：如果宿主机目录权限不正确，entrypoint 脚本会自动修复权限
    volumes:
      # HOME 配置目录（accounts.json、SQLite DB 等会保存在这里）
      # Entrypoint 脚本会在启动时自动修复此目录的权限
      - ../data:/home/node/.config/antigravity-proxy
      # 可选：挂载自定义 config.json（宿主机必须是"文件"，不能是目录）
      # - ./config.json:/home/node/.config/antigravity-proxy/config.json:ro

    restart: unless-stopped

